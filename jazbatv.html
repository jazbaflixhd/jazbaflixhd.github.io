<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jazba TV | Free on Jazz</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --accent: #00ff88;
  --bg: #0b0f14;
  --card: #121a22;
  --text: #eaf2ff;
  --gradient-start: #00ff88;
  --gradient-end: #00c6ff;
}

html, body {
  height: 100%;
  overflow: hidden;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  display: flex;
  flex-direction: column;
}

.container {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Header */
.header {
  padding: 10px 15px;
  background: var(--bg);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.logo {
  font-size: 26px;
  font-weight: 900;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.tagline {
  color: #8fa3b8;
  font-size: 10px;
}

.header-right {
  display: flex;
  gap: 10px;
}

.header-btn {
  background: rgba(255,255,255,0.08);
  border: none;
  cursor: pointer;
  padding: 7px;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.header-btn svg {
  width: 18px;
  height: 18px;
  fill: #fff;
}

/* Search */
.search-container {
  position: absolute;
  top: 15px;
  left: 10px;
  right: 103px;
  z-index: 101;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  display: flex;
  gap: 8px;
}

.search-container.active {
  opacity: 1;
  visibility: visible;
}

.search-wrapper {
  flex: 1;
  position: relative;
}

.search-container input {
  width: 100%;
  padding: 10px 12px 10px 40px;
  border-radius: 20px;
  border: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
  font-size: 14px;
}

.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  fill: #fff;
}

.close-btn {
  background: rgba(0,0,0,0.3);
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-btn svg {
  width: 18px;
  height: 18px;
  stroke: #fff;
}

/* Categories */
.categories-container {
  display: flex;
  overflow-x: auto;
  gap: 6px;
  padding: 15px 6px;
  scrollbar-width: none;
}

.categories-container::-webkit-scrollbar {
  display: none;
}

.category-chip {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.1);
  color: var(--text);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 6px;
}

.category-chip.active {
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  color: #000;
}

.category-chip-count {
  font-size: 10px;
  background: rgba(0,0,0,0.2);
  padding: 1px 5px;
  border-radius: 10px;
}

/* Main Content */
.content-wrapper {
  flex: 1;
  overflow-y: auto;
  padding: 0 15px;
  height: calc(100vh - 250px);
}

.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  padding: 0 0 80px 0;
}

/* Cards */
.card {
  background: var(--card);
  border-radius: 14px;
  overflow: hidden;
  height: 165px;
  display: flex;
  flex-direction: column;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,0.05);
}

.img {
  height: 90px;
  width: 100%;
  position: relative;
  overflow: hidden;
}

.img img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.live {
  position: absolute;
  top: 6px;
  left: 6px;
  background: #E50914;
  padding: 3px 6px;
  font-size: 10px;
  border-radius: 10px;
  color: white;
  display: flex;
  align-items: center;
  gap: 3px;
}

.live::before {
  content: '';
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

@keyframes blink {
  0%,100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.viewers {
  position: absolute;
  bottom: 6px;
  left: 6px;
  background: rgba(0,0,0,0.8);
  padding: 3px 6px;
  font-size: 9px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.viewers svg {
  width: 12px;
  height: 12px;
  fill: #fff;
}

.info {
  padding: 8px 10px;
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.name {
  font-size: 13px;
  font-weight: 700;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 95%;
}

.tag2 {
  font-size: 10px;
  color: var(--accent);
  margin: 3px 0;
  padding: 2px 6px;
  border-radius: 8px;
  background: rgba(0,255,136,0.1);
}

.row {
  display: flex;
  justify-content: space-between;
  width: 100%;
  padding: 0 6px;
}

.no {
  color: var(--accent);
  font-size: 14px;
  font-weight: 900;
}

.q {
  font-size: 9px;
  border: 1px solid var(--accent);
  padding: 2px 6px;
  border-radius: 6px;
  color: var(--accent);
}

/* Channel Details Page */
.channel-details-page {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  z-index: 9999;
  display: none;
  flex-direction: column;
}

.channel-details-page.active {
  display: flex;
}

.player-wrapper {
  width: 100%;
  background: #000;
  position: relative;
}

.video-container {
  width: 100%;
  position: relative;
  aspect-ratio: 16/9;
  background: #000;
}

.video-container video {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: contain;
}

/* Play Button */
.center-play {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 100;
  transition: opacity 0.3s ease;
  background: none;
}

.center-play.show {
  opacity: 1;
  pointer-events: auto;
}

.center-play.hide {
  opacity: 0;
  pointer-events: none;
}

.center-play svg {
  width: 40px;
  height: 40px;
  fill: white;
  filter: drop-shadow(0 0 10px rgba(0,0,0,0.7));
}

.center-play::before {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  border-radius: 50%;
  animation: ripple 2s infinite;
  z-index: -1;
}

@keyframes ripple {
  0% { transform: scale(0.8); opacity: 1; }
  100% { transform: scale(1.2); opacity: 0; }
}

/* Controls */
.controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 15px;
  background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  z-index: 25;
  opacity: 0;
  transition: opacity 0.3s;
  display: flex;
  justify-content: flex-end;
}

.controls.show {
  opacity: 1;
}

.top-controls {
  position: absolute;
  top: 15px;
  right: 14px;
  z-index: 30;
  opacity: 0;
  transition: opacity 0.3s;
}

.controls.show ~ .top-controls {
  opacity: 1;
}

.control-btn {
  background: transparent;
  border: none;
  cursor: pointer;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.control-btn svg {
  width: 26px;
  height: 26px;
  fill: #fff;
}

/* Live Badge */
.live-badge {
  position: absolute;
  top: 20px;
  left: 18px;
  background: #E50914;
  color: white;
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 4px;
  z-index: 25;
}

.live-badge::before {
  content: '';
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

/* Loading Spinner */
.loading-spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 50px;
  height: 50px;
  z-index: 50;
  display: none;
}

.loading-spinner.show {
  display: block;
}

.spinner {
  border: 3px solid rgba(255,255,255,0.1);
  border-top: 3px solid var(--accent);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Video Preview */
.video-preview {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.video-preview.hide {
  opacity: 0;
  pointer-events: none;
}

.video-preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0.7;
}

/* Channel Info */
.channel-ui-scrollable {
  flex: 1;
  overflow-y: auto;
  padding: 20px 15px;
  background: #000;
}

.channel-header {
  display: flex;
  gap: 20px;
  align-items: center;
  margin-bottom: 20px;
}

.channel-logo {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  overflow: hidden;
}

.channel-logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.channel-title h1 {
  font-size: 20px;
  color: #fff;
  margin-bottom: 6px;
}

.live-badge-channel {
  display: inline-block;
  background: #E50914;
  color: white;
  padding: 3px 8px;
  border-radius: 10px;
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.live-badge-channel::before {
  content: '';
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
  animation: blink 1.5s infinite;
}

.channel-desc {
  color: #b3b3b3;
  font-size: 14px;
  line-height: 1.5;
  margin-bottom: 20px;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: rgba(20,20,20,0.95);
  color: white;
  padding: 14px 24px;
  border-radius: 50px;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s;
}

.toast.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0);
}

.toast.success {
  background: linear-gradient(135deg, rgba(0,255,136,0.2), rgba(0,198,255,0.2));
  border: 1px solid rgba(0,255,136,0.3);
}

.toast-icon {
  width: 18px;
  height: 18px;
  background: #00ff88;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.toast-icon svg {
  width: 12px;
  height: 12px;
  fill: white;
}

/* Fullscreen */
#playerWrapper:fullscreen video,
#playerWrapper:-webkit-full-screen video {
  width: 100vw;
  height: 100vh;
  object-fit: contain;
}

@media (orientation: landscape) {
  #playerWrapper:fullscreen,
  #playerWrapper:-webkit-full-screen {
    orientation: landscape;
  }
}
</style>
</head>

<body class="sports-neon">

<!-- Toast -->
<div class="toast" id="toast">
  <div class="toast-icon">
    <svg viewBox="0 0 24 24">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
  </div>
  <span id="toastMessage"></span>
</div>

<!-- Main Container -->
<div class="container" id="mainContainer">
  <!-- Header -->
  <div class="header" id="header">
    <div>
      <div class="logo">JazbaTV</div>
      <div class="tagline">Free on Jazz</div>
    </div>

    <div class="header-right">
      <button class="header-btn" id="searchToggleBtn">
        <svg viewBox="0 0 24 24">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5z"/>
        </svg>
      </button>
      
      <button class="header-btn" id="moreOptionsBtn">
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="2"/>
          <circle cx="12" cy="5" r="2"/>
          <circle cx="12" cy="19" r="2"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-container" id="searchContainer">
    <div class="search-wrapper">
      <svg class="search-icon" viewBox="0 0 24 24">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5z"/>
      </svg>
      <input id="search" placeholder="Search channels..." type="search">
    </div>
    <button class="close-btn" id="closeSearchBtn">
      <svg viewBox="0 0 24 24" stroke="white" stroke-width="2">
        <path d="M18 6L6 18M6 6L18 18"/>
      </svg>
    </button>
  </div>

  <!-- Categories -->
  <div class="categories-container" id="categoriesContainer"></div>

  <!-- Main Content -->
  <div class="content-wrapper" id="contentWrapper">
    <div class="grid" id="grid"></div>
  </div>
</div>

<!-- Channel Details Page -->
<div class="channel-details-page" id="channelDetailsPage">
  <div class="player-wrapper" id="playerWrapper">
    <div class="video-container" id="videoContainer">
      <video id="video" playsinline></video>
      
      <!-- Video Preview -->
      <div class="video-preview" id="videoPreview">
        <img id="previewImage" src="" alt="">
      </div>
      
      <!-- Loading Spinner -->
      <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
      </div>
      
      <!-- Live Badge -->
      <div class="live-badge" id="liveBadge">LIVE</div>
      
      <!-- Top Controls -->
      <div class="top-controls">
        <button class="control-btn" id="fullscreenBtn">
          <svg viewBox="0 0 24 24">
            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
          </svg>
        </button>
      </div>
      
      <!-- Center Play Button -->
      <div class="center-play" id="cPlay">
        <svg viewBox="0 0 24 24">
          <path d="M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18c.62-.39.62-1.29 0-1.68L9.54 5.98C8.87 5.55 8 6.03 8 6.82z"/>
        </svg>
      </div>

      <!-- Bottom Controls -->
      <div class="controls" id="controls">
        <div class="controls-right">
          <button class="control-btn" id="pipBtn">
            <svg viewBox="0 0 24 24">
              <path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Channel Info -->
  <div class="channel-ui-scrollable">
    <div class="channel-header">
      <div class="channel-logo">
        <img src="" id="channelLogo" alt="">
      </div>
      <div class="channel-title">
        <h1 id="channelName">Channel Name</h1>
        <span class="live-badge-channel" id="channelLiveBadge">LIVE</span>
      </div>
    </div>
    
    <p class="channel-desc" id="channelDescription"></p>
  </div>
</div>

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
// ================ CHANNELS DATA - DIRECT HARDCODED ================
const CHANNELS = [
  {
    "n": "ICC T20 World Cup 2026",
    "c": "Sports",
    "no": 116,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/t20worldcup.webp",
    "vid": "https://tencentcdn11.tamashaweb.com/v1/019bf9b9eb3215fc600b35c80a5fba/019bffdc5fb61ea540a817848da787/TMSH_WEB2_CLEAN.m3u8",
    "live": true,
    "desc": "ICC Men's T20 World Cup 2026"
  },
  {
    "n": "Ten Sports",
    "c": "Sports",
    "no": 115,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/tensport.webp",
    "vid": "https://cdn12isb.tamashaweb.com:8087/YlUHeDQb7a/157-3H/playlist.m3u8",
    "live": true,
    "desc": "Premier sports channel"
  },
  {
    "n": "PTV SPORTS",
    "c": "Sports",
    "no": 114,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/ptvsports.webp",
    "vid": "https://cdn12isb.tamashaweb.com:8087/jazzauth/189H/playlist.m3u8",
    "live": true,
    "desc": "Pakistan's sports channel"
  },
  {
    "n": "ARY News",
    "c": "News",
    "no": 113,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/arynews.webp",
    "vid": "https://cdn07isb.tamashaweb.com:8087/jazzauth/vsat-arynews-abr/playlist.m3u8",
    "live": true,
    "desc": "24/7 news channel"
  },
  {
    "n": "Geo News",
    "c": "News",
    "no": 112,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/geonews.webp",
    "vid": "https://cdn07isb.tamashaweb.com:8087/jazzauth/vsat-geonews-abr/playlist.m3u8",
    "live": true,
    "desc": "Pakistan's most-watched news"
  },
  {
    "n": "Dawn News",
    "c": "News",
    "no": 110,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/dawnnews.webp",
    "vid": "https://cdn21lhr.tamashaweb.com:8087/jazzauth/DawnNews-abr/playlist.m3u8",
    "live": true,
    "desc": "English news channel"
  },
  {
    "n": "Hum TV",
    "c": "Entertainment",
    "no": 105,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/humtv.webp",
    "vid": "https://cdn22lhr.tamashaweb.com:8087/jazzauth/humTV-abr/playlist.m3u8",
    "live": true,
    "desc": "Leading entertainment"
  },
  {
    "n": "ARY Digital",
    "c": "Entertainment",
    "no": 104,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/arydigital.webp",
    "vid": "https://cdn07lhr.tamashaweb.com:8087/jazzauth/vsat-arydigital-abr/playlist.m3u8",
    "live": true,
    "desc": "Top entertainment channel"
  },
  {
    "n": "PTV Home",
    "c": "Entertainment",
    "no": 103,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/ptvhome.webp",
    "vid": "https://cdn05khi.tamashaweb.com:8087/jazzauth/PTVHome-abr/playlist.m3u8",
    "live": true,
    "desc": "Pakistan Television"
  },
  {
    "n": "CNN",
    "c": "News",
    "no": 99,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/cnn.webp",
    "vid": "https://cdn23lhr.tamashaweb.com:8087/jazzauth/Livecnn-abr/playlist.m3u8",
    "live": true,
    "desc": "Global news leader"
  },
  {
    "n": "Aljazeera",
    "c": "News",
    "no": 100,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/aljazeera.webp",
    "vid": "https://cdn23lhr.tamashaweb.com:8087/jazzauth/AL-Jazeera-abr/playlist.m3u8",
    "live": true,
    "desc": "International news"
  },
  {
    "n": "Discovery HD",
    "c": "Documentary",
    "no": 98,
    "img": "https://file.garden/aWfBGfhwaGcNwkre/discoverychnl.webp",
    "vid": "https://cdn05khi.tamashaweb.com:8087/jazzauth/DiscoveryHD-abr/playlist.m3u8",
    "live": true,
    "desc": "Documentary channel"
  }
];

// ================ GLOBAL VARIABLES ================
let hls = null;
let currentChannel = null;
let hidePlayButtonTimer = null;
let controlsTimer = null;
let isPlaying = false;

// DOM Elements
const grid = document.getElementById("grid");
const search = document.getElementById("search");
const searchToggleBtn = document.getElementById("searchToggleBtn");
const searchContainer = document.getElementById("searchContainer");
const closeSearchBtn = document.getElementById("closeSearchBtn");
const categoriesContainer = document.getElementById('categoriesContainer');
const channelDetailsPage = document.getElementById("channelDetailsPage");
const videoPlayer = document.getElementById("video");
const videoPreview = document.getElementById("videoPreview");
const previewImage = document.getElementById("previewImage");
const loadingSpinner = document.getElementById("loadingSpinner");
const cPlay = document.getElementById("cPlay");
const pipBtn = document.getElementById("pipBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const liveBadge = document.getElementById("liveBadge");
const channelLogo = document.getElementById("channelLogo");
const channelName = document.getElementById("channelName");
const channelDescription = document.getElementById("channelDescription");
const channelLiveBadge = document.getElementById("channelLiveBadge");
const playerControls = document.getElementById("controls");
const toast = document.getElementById("toast");
const toastMessage = document.getElementById("toastMessage");
const mainContainer = document.getElementById("mainContainer");
const moreOptionsBtn = document.getElementById("moreOptionsBtn");

// ================ FUNCTIONS ================

// Toast
function showToast(message, type = 'success') {
  toastMessage.textContent = message;
  toast.className = 'toast';
  toast.classList.add(type);
  setTimeout(() => toast.classList.add('show'), 10);
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// Format viewers
function formatViewerCount(count) {
  if (count >= 1000000) return (count / 1000000).toFixed(1) + 'M';
  if (count >= 1000) return (count / 1000).toFixed(1) + 'K';
  return count.toString();
}

// Random viewers
function getRandomViewerCount() {
  return Math.floor(5000 + Math.random() * 25000);
}

// ================ PLAY BUTTON CONTROL ================
function updatePlayButton(forceShow = false) {
  if (!videoPlayer || !cPlay) return;
  
  if (hidePlayButtonTimer) {
    clearTimeout(hidePlayButtonTimer);
    hidePlayButtonTimer = null;
  }
  
  if (videoPlayer.paused || forceShow) {
    cPlay.classList.remove('hide');
    cPlay.classList.add('show');
  } else {
    cPlay.classList.add('show');
    cPlay.classList.remove('hide');
    hidePlayButtonTimer = setTimeout(() => {
      if (!videoPlayer.paused) {
        cPlay.classList.add('hide');
        cPlay.classList.remove('show');
      }
    }, 3000);
  }
}

// ================ SHOW CONTROLS ================
function showControls() {
  playerControls.classList.add('show');
  document.querySelector('.top-controls').style.opacity = '1';
  
  if (controlsTimer) clearTimeout(controlsTimer);
  controlsTimer = setTimeout(() => {
    if (isPlaying) {
      playerControls.classList.remove('show');
      document.querySelector('.top-controls').style.opacity = '0';
    }
  }, 3000);
}

// ================ BUILD CATEGORIES ================
function buildCategories() {
  const categories = ['All', ...new Set(CHANNELS.map(c => c.c))];
  categoriesContainer.innerHTML = '';
  
  categories.forEach(cat => {
    const count = cat === 'All' ? CHANNELS.length : CHANNELS.filter(c => c.c === cat).length;
    const chip = document.createElement('div');
    chip.className = `category-chip ${cat === 'All' ? 'active' : ''}`;
    chip.dataset.category = cat;
    chip.innerHTML = `${cat} <span class="category-chip-count">${count}</span>`;
    chip.addEventListener('click', () => {
      document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      filterChannels(cat);
    });
    categoriesContainer.appendChild(chip);
  });
}

// ================ FILTER CHANNELS ================
function filterChannels(category) {
  const term = search.value.toLowerCase().trim();
  document.querySelectorAll('.card').forEach(card => {
    const catMatch = category === 'All' || card.dataset.category === category;
    const searchMatch = term === '' || card.dataset.name.includes(term);
    card.style.display = catMatch && searchMatch ? 'block' : 'none';
  });
}

// ================ BUILD CARDS ================
function buildCards() {
  grid.innerHTML = '';
  
  CHANNELS.forEach((channel, index) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.name = channel.n.toLowerCase();
    card.dataset.channelNo = channel.no;
    card.dataset.category = channel.c;
    
    const viewers = getRandomViewerCount();
    
    card.innerHTML = `
      <div class="img">
        <img src="${channel.img}" alt="${channel.n}" loading="lazy">
        ${channel.live ? '<div class="live">LIVE</div>' : ''}
        <div class="viewers">
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="7" r="3.5" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M5 20c0-3.9 3.1-7 7-7s7 3.1 7 7" stroke="currentColor" stroke-width="1.5" fill="none"/>
          </svg>
          <span>${formatViewerCount(viewers)} watching</span>
        </div>
      </div>
      <div class="info">
        <div class="name">${channel.n}</div>
        <div class="tag2">${channel.c}</div>
        <div class="row">
          <div class="no">${channel.no}</div>
          <div class="q">HD</div>
        </div>
      </div>`;
    
    card.addEventListener('click', () => openChannel(channel));
    grid.appendChild(card);
    
    setTimeout(() => card.style.opacity = '1', index * 50);
  });
}

// ================ OPEN CHANNEL ================
function openChannel(channel) {
  currentChannel = channel;
  
  mainContainer.style.display = 'none';
  channelDetailsPage.classList.add('active');
  
  channelLogo.src = channel.img;
  channelName.textContent = channel.n;
  channelDescription.textContent = channel.desc || "Watch live streaming";
  previewImage.src = channel.img;
  
  if (channel.live) {
    liveBadge.style.display = 'flex';
    channelLiveBadge.style.display = 'inline-flex';
  } else {
    liveBadge.style.display = 'none';
    channelLiveBadge.style.display = 'none';
  }
  
  // Load video
  loadingSpinner.classList.add('show');
  videoPreview.classList.remove('hide');
  
  if (hls) hls.destroy();
  
  if (Hls.isSupported() && channel.vid.includes('.m3u8')) {
    hls = new Hls();
    hls.loadSource(channel.vid);
    hls.attachMedia(videoPlayer);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      videoPlayer.play();
      loadingSpinner.classList.remove('show');
      videoPreview.classList.add('hide');
      isPlaying = true;
      updatePlayButton();
    });
  } else {
    videoPlayer.src = channel.vid;
    videoPlayer.play();
    videoPlayer.onloadeddata = () => {
      loadingSpinner.classList.remove('show');
      videoPreview.classList.add('hide');
      isPlaying = true;
      updatePlayButton();
    };
  }
  
  history.pushState({ channel: channel.no }, '', `#${channel.no}`);
}

// ================ CLOSE CHANNEL ================
function closeChannel() {
  if (hls) hls.destroy();
  videoPlayer.pause();
  videoPlayer.src = '';
  channelDetailsPage.classList.remove('active');
  mainContainer.style.display = 'flex';
  currentChannel = null;
  isPlaying = false;
  if (history.state) history.back();
}

// ================ SETUP EVENT LISTENERS ================
function setupEventListeners() {
  // Search
  searchToggleBtn.addEventListener('click', () => {
    searchContainer.classList.add('active');
    searchToggleBtn.style.opacity = '0';
    setTimeout(() => search.focus(), 300);
  });
  
  closeSearchBtn.addEventListener('click', () => {
    searchContainer.classList.remove('active');
    searchToggleBtn.style.opacity = '1';
    search.value = '';
    filterChannels('All');
  });
  
  search.addEventListener('input', () => {
    const activeCat = document.querySelector('.category-chip.active')?.dataset.category || 'All';
    filterChannels(activeCat);
  });
  
  // Play button
  cPlay.addEventListener('click', (e) => {
    e.stopPropagation();
    if (videoPlayer.paused) {
      videoPlayer.play();
    } else {
      videoPlayer.pause();
    }
  });
  
  // Video events
  videoPlayer.addEventListener('play', () => {
    isPlaying = true;
    updatePlayButton();
    showControls();
  });
  
  videoPlayer.addEventListener('pause', () => {
    isPlaying = false;
    updatePlayButton(true);
  });
  
  videoPlayer.addEventListener('click', () => {
    showControls();
    updatePlayButton(true);
  });
  
  // PiP
  pipBtn.addEventListener('click', async () => {
    try {
      if (document.pictureInPictureElement) {
        await document.exitPictureInPicture();
      } else {
        await videoPlayer.requestPictureInPicture();
      }
    } catch (err) {}
  });
  
  // Fullscreen
  fullscreenBtn.addEventListener('click', () => {
    const pw = document.getElementById('playerWrapper');
    if (!document.fullscreenElement) {
      pw.requestFullscreen();
      if (screen.orientation?.lock) {
        screen.orientation.lock('landscape').catch(() => {});
      }
    } else {
      document.exitFullscreen();
    }
  });
  
  // Back button
  window.addEventListener('popstate', () => {
    if (channelDetailsPage.classList.contains('active')) closeChannel();
  });
  
  // Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && channelDetailsPage.classList.contains('active')) closeChannel();
  });
  
  // More options
  moreOptionsBtn.addEventListener('click', () => {
    showToast('Jazba TV - Free on Jazz');
  });
}

// ================ INITIALIZE ================
function init() {
  buildCategories();
  buildCards();
  setupEventListeners();
  showToast('Channels Loaded!', 'success');
}

// Start
window.addEventListener('load', init);
</script>

</body>
</html>